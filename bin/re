#!/bin/bash

pwd_escaped=$(pwd | sed 's!/!%!g')
files=( "$@" )

# open files in reversed order
cmd=''
for ((i=${#files[@]}-1; i>=0; i--)); do
    item="${files[$i]}"
    filename=$(echo "${item}" | cut -d':' -f1)
    line=$(echo "${item}" | cut -d':' -f2)
    column=$(echo "${item}" | cut -d':' -f3)
    cmd+="<esc>:tab drop ${filename}<cr>${line}G${column}|"
done

export NVIM_LISTEN_ADDRESS="/tmp/nvim-${pwd_escaped}"

exec nvr -s --nostart --remote-send "${cmd}"
